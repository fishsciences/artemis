<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Simulate eDNA data — sim_eDNA_lm • artemis</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Simulate eDNA data — sim_eDNA_lm" />
<meta property="og:description" content="Simulate eDNA data" />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">artemis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/artemis-installation-guide.html">ARTEMIS Installation Guide</a>
    </li>
    <li>
      <a href="../articles/artemis-overview.html">Getting started with the artemis package</a>
    </li>
    <li>
      <a href="../articles/modeling.html">Modeling eDNA qPCR Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating eDNA Data with `artemis`</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate eDNA data</h1>
    
    <div class="hidden name"><code>sim_eDNA_lmer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulate eDNA data</p>
    </div>

    <pre class="usage"><span class='fu'>sim_eDNA_lm</span>(
  <span class='no'>formula</span>,
  <span class='no'>variable_list</span>,
  <span class='no'>betas</span>,
  <span class='no'>sigma_Cq</span>,
  <span class='no'>std_curve_alpha</span>,
  <span class='no'>std_curve_beta</span>,
  <span class='kw'>n_sim</span> <span class='kw'>=</span> <span class='fl'>1L</span>,
  <span class='kw'>upper_Cq</span> <span class='kw'>=</span> <span class='fl'>40</span>,
  <span class='kw'>X</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span>(<span class='no'>variable_list</span>),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>sink_file</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>()
)

<span class='fu'>sim_eDNA_lmer</span>(
  <span class='no'>formula</span>,
  <span class='no'>variable_list</span>,
  <span class='no'>betas</span>,
  <span class='no'>sigma_Cq</span>,
  <span class='no'>sigma_rand</span>,
  <span class='no'>std_curve_alpha</span>,
  <span class='no'>std_curve_beta</span>,
  <span class='kw'>n_sim</span> <span class='kw'>=</span> <span class='fl'>1L</span>,
  <span class='kw'>upper_Cq</span> <span class='kw'>=</span> <span class='fl'>40</span>,
  <span class='kw'>X</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span>(<span class='no'>variable_list</span>),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>sink_file</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>()
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>a model formula, e.g. <code>y ~ x1 + x2</code>. For <code>sim_eDNA_lmer</code>,
random intercepts can also be provided, e.g. <code> ( 1 | rep ) </code>.</p></td>
    </tr>
    <tr>
      <th>variable_list</th>
      <td><p>a named list, with the levels that each variable can take.
Please note that the variables listed in the formula, including the
response variable, must be present in the variable_list or in the X design matrix.
Extra variables, i.e. variables which do not occur in the formula, are ignored.</p></td>
    </tr>
    <tr>
      <th>betas</th>
      <td><p>numeric vector, the beta for each variable in the design matrix</p></td>
    </tr>
    <tr>
      <th>sigma_Cq</th>
      <td><p>numeric, the measurement error on CQ.</p></td>
    </tr>
    <tr>
      <th>std_curve_alpha</th>
      <td><p>the alpha value for the formula for converting between
log(eDNA concentration) and CQ value</p></td>
    </tr>
    <tr>
      <th>std_curve_beta</th>
      <td><p>the beta value for the formula for converting between
log(eDNA concentration) and CQ value</p></td>
    </tr>
    <tr>
      <th>n_sim</th>
      <td><p>integer, the number of cases to simulate</p></td>
    </tr>
    <tr>
      <th>upper_Cq</th>
      <td><p>numeric, the upper limit on CQ detection. Any value of
log(concentration) which would result in a value greater than this limit is
instead recorded as the limit.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>optional, a design matrix. By default, this is created
from the variable_list using <code><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid()</a></code>, which creates
a balanced design matrix. However, the user can provide their own <code>X</code>
as well, in which case the variable_list is ignored. This allows users to
provide an unbalanced design matrix.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical, when TRUE output from <code><a href='https://rdrr.io/pkg/rstan/man/stanmodel-method-sampling.html'>rstan::sampling</a></code> is written
to the console.</p></td>
    </tr>
    <tr>
      <th>sink_file</th>
      <td><p>character, a file to write the console output to
if <code>verbose = FALSE</code>, by default writes to
<code><a href='https://rdrr.io/r/base/tempfile.html'>tempfile()</a></code></p></td>
    </tr>
    <tr>
      <th>sigma_rand</th>
      <td><p>numeric vector, the stdev for the random effects. There must be
one sigma per random effect specified</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>S4 object of class "eDNA_simulation_lm/lmer" with the following slots:</p><dl'>
  <dt>ln_conc matrix</dt><dd><p>the simulated log(concentration)</p></dd>
  <dt>Cq_star matrix</dt><dd><p>the simulated CQ values, including the measurement error</p></dd>
  <dt>formula</dt><dd><p>the formula for the simulation</p></dd>
  <dt>variable_levels</dt><dd><p>named list, the variable levels used for the simulation</p></dd>
  <dt>betas</dt><dd><p>numeric vector, the betas for the simulation</p></dd>
  <dt>x</dt><dd><p>data.frame, the design matrix</p></dd>
  <dt>std_curve_alpha numeric</dt><dd><p>the alpha for the std curve conversion</p></dd>
  <dt>std_curve_beta numeric</dt><dd><p>the alpha for the std curve conversion</p></dd>
  <dt>upper_Cq</dt><dd><p>the upper limit for CQ</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>These functions allow for computationally efficient simulation of
Cq values from a hypothetical eDNA sampling experiment via a
series of effect sizes (<code>betas</code>) on a number of predictor or
variable levels (<code>variable_levels</code>). The mechanism for this
model is described in detail in the artemis "Getting Started"
vignette.</p>
<p>The simulation functions call to specialized functions which are
written in Stan and are compiled to provide speed. This also
allows the simulation functions and the modeling functions to
reflect the same process at the code level.</p>
    <h2 class="hasAnchor" id="diagnosing-unrealistic-simulations"><a class="anchor" href="#diagnosing-unrealistic-simulations"></a>Diagnosing "unrealistic" simulations</h2>

    


<p>Users will find that sometimes the simulationed response (i.e. Cq
values) produced by this function are not similar to expected data
collected from a sampling experiment. This circumstance suggests
that there is a mismatch between the assumptions of the model and
the data generating process in the field. For these circumstances,
we suggest:</p>
<ol>
<li><p>Check that the <code>betas</code> provided are the
effect sizes on the predictor on the log[eDNA concentration], and
not the Cq values.</p></li>
<li><p>Check that the variable levels provided are representative
of real-world circumstances. For example, a sample volume of 0 ml
is not possible.</p></li>
<li><p>Verify the values for the standard curve alpha and
beta. These are specific to each calibration for the lab, so it is
important that you use the same conversion between Cq values and
log[eDNA concentration] as the comparison data.</p></li>
</ol>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Includes extra variables</span>
<span class='no'>vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>Intercept</span> <span class='kw'>=</span> -<span class='fl'>10.6</span>,
            <span class='kw'>distance</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>15</span>, <span class='fl'>50</span>),
            <span class='kw'>volume</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>25</span>, <span class='fl'>50</span>),
            <span class='kw'>biomass</span> <span class='kw'>=</span> <span class='fl'>100</span>,
            <span class='kw'>alive</span> <span class='kw'>=</span> <span class='fl'>1</span>,
            <span class='kw'>tech_rep</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>10</span>,
            <span class='kw'>rep</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>Cq</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='co'>## Intercept only</span>
<span class='no'>ans</span> <span class='kw'>=</span> <span class='fu'>sim_eDNA_lm</span>(<span class='no'>Cq</span> ~ <span class='fl'>1</span>, <span class='no'>vars</span>,
                      <span class='kw'>betas</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>intercept</span> <span class='kw'>=</span> -<span class='fl'>15</span>),
                      <span class='kw'>sigma_Cq</span> <span class='kw'>=</span> <span class='fl'>1e-5</span>,
                      <span class='kw'>std_curve_alpha</span> <span class='kw'>=</span> <span class='fl'>21.2</span>, <span class='kw'>std_curve_beta</span> <span class='kw'>=</span> -<span class='fl'>1.5</span>)</div><div class='output co'>#&gt; <span class='message'>Compiling Stan program...</span></div><div class='output co'>#&gt; Running MCMC with 1 chain(s) on 1 core(s)...
#&gt; 
#&gt; Running ./eDNA_sim_omni 'id=1' random 'seed=958925184' data \
#&gt;   'file=/var/folders/tt/y4p3sd8x1d90ztlbsyjthmfc0000gn/T/RtmpievvJ0/standata-20502e977847.json' \
#&gt;   output \
#&gt;   'file=/var/folders/tt/y4p3sd8x1d90ztlbsyjthmfc0000gn/T/RtmpievvJ0/eDNA_sim_omni-202006231120-1-599536.csv' \
#&gt;   'method=sample' 'num_samples=1' 'num_warmup=0' 'save_warmup=0' \
#&gt;   'algorithm=fixed_param' adapt 'engaged=1'
#&gt; Chain 1 Iteration: 1 / 1 [100%]  (Sampling) 
#&gt; Chain 1 finished in 0.2 seconds.</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>ans</span>)</div><div class='output co'>#&gt; 
#&gt; formula: Cq ~ 1
#&gt; &lt;environment: 0x7fd3a89b8350&gt;
#&gt; 
#&gt; Standard curve parameters: Cq = alpha + beta * log(concentration)
#&gt; 	Standard curve alpha =  21.2 
#&gt; 	Standard curve beta =  -1.5 
#&gt; 
#&gt;  ln concentration: 
#&gt;  variable level 2.5% 50% 97.5% mean p_detect
#&gt;        V1     1  -15 -15   -15  -15       NA
#&gt; 
#&gt;  simulated Cq: 
#&gt;  variable level 2.5% 50% 97.5% mean p_detect
#&gt;        V1     1   40  40    40   40        0</div><div class='input'>
<span class='no'>ans</span> <span class='kw'>=</span> <span class='fu'>sim_eDNA_lm</span>(<span class='no'>Cq</span> ~ <span class='no'>distance</span> + <span class='no'>volume</span>, <span class='no'>vars</span>,
                  <span class='kw'>betas</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>intercept</span> <span class='kw'>=</span> -<span class='fl'>10.6</span>, <span class='kw'>distance</span> <span class='kw'>=</span> -<span class='fl'>0.05</span>, <span class='kw'>volume</span> <span class='kw'>=</span> <span class='fl'>0.1</span>),
                  <span class='kw'>sigma_Cq</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>std_curve_alpha</span> <span class='kw'>=</span> <span class='fl'>21.2</span>, <span class='kw'>std_curve_beta</span> <span class='kw'>=</span> -<span class='fl'>1.5</span>)</div><div class='output co'>#&gt; <span class='message'>Model executable is up to date!</span></div><div class='output co'>#&gt; Running MCMC with 1 chain(s) on 1 core(s)...
#&gt; 
#&gt; Running ./eDNA_sim_omni 'id=1' random 'seed=840353518' data \
#&gt;   'file=/var/folders/tt/y4p3sd8x1d90ztlbsyjthmfc0000gn/T/RtmpievvJ0/standata-20502f533a91.json' \
#&gt;   output \
#&gt;   'file=/var/folders/tt/y4p3sd8x1d90ztlbsyjthmfc0000gn/T/RtmpievvJ0/eDNA_sim_omni-202006231120-1-2a1ddd.csv' \
#&gt;   'method=sample' 'num_samples=1' 'num_warmup=0' 'save_warmup=0' \
#&gt;   'algorithm=fixed_param' adapt 'engaged=1'
#&gt; Chain 1 Iteration: 1 / 1 [100%]  (Sampling) 
#&gt; Chain 1 finished in 0.1 seconds.</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Myfanwy Johnston, Matt Espe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


