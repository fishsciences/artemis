<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with the artemis package • artemis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with the artemis package">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">artemis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/artemis-installation-guide.html">ARTEMIS Installation Guide</a>
    </li>
    <li>
      <a href="../articles/artemis-overview.html">Getting started with the artemis package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with the artemis package</h1>
            
      
      
      <div class="hidden name"><code>artemis-overview.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <code>artemis</code> package was created to aid in the design and analysis of environmental DNA (eDNA) survey studies by offering a custom suite of models for eDNA sampling and qPCR data. Typically, data collected from these studies are modeled using a simple binary response of detection/no detection. While this approach has been OK, there are several characteristics of eDNA data which made us feel that it would benefit from a different modeling approach:</p>
<ol style="list-style-type: decimal">
<li><p>In eDNA samples, the concentration of eDNA is not directly measured. Instead, the amount of eDNA present is represented as a function of the number of quantification cycles of qPCR (hereafter referred to as the “Cq” value) completed before amplification takes place. eDNA concentration (<span class="math inline">\([eDNA]\)</span>) is then related to Cq via a standard curve generated in the lab for the target species. This standard curve formula typically takes the form: <span class="math display">\[Cq = log[eDNA] * \beta + \alpha\]</span> The standard curve is specific to the lab reagents and techniques used. <em>The implication of this is that models using Cq values (or a derived value such as “postitive detection”) as the response result in estimates of effect sizes which cannot be directly compared between different studies using different standard curves.</em></p></li>
<li><p>A higher Cq value corresponds to a lower concentration of eDNA in a sample. Above a pre-determined threshold, additional quantification cycles are not attempted. Therefore, “non-detection” is taken to be any sample which requires more than the threshold number of cycles to detect. <em>Not taking this data truncation process into account in the model can result in increased uncertainty and bias in our estimates of the effect sizes.</em></p></li>
<li><p>The potential sources of measurement error in the extraction and qPCR processes are difficult to separate and quantify. For example, Cq values produced by qPCR become more variable at the threshold of detection, i.e. as the number of eDNA molecules available for amplification approaches zero. This source of variability in the response is different from that produced by error introduced in the pipetting process during extraction, but they have the same effect on Cq (namely, increasing variability).</p></li>
</ol>
<p>The <code>artemis</code> package addresses these issues by directly modeling the effect of the predictors on the latent (unobserved) variable, eDNA concentration. It does this by linking eDNA concentration to the observed response via the standard curve parameters. The general model is as follows:</p>
<p><span class="math display">\[ Cq_i \sim Normal(\hat{Cq_i}, \sigma_{Cq}) \\
\hat{Cq_i} = \alpha_{std\_curve} + \beta_{std\_curve}* log[eDNA]_i  \\
log[eDNA]_{i} = X_{i} \beta\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is a vector of effects on <span class="math inline">\(log[eDNA]\)</span>, <span class="math inline">\(X\)</span> is the model matrix of predictors and <span class="math inline">\(\alpha_{std\_curve}\)</span> and <span class="math inline">\(\beta_{std\_curve}\)</span> are fixed values provided by the standard curve.</p>
<p>As detection limits vary with genetic assay, the upper threshold on Cq in the model is adjustable. Any values of <span class="math inline">\(\hat{Cq_i}\)</span> which are greater than the upper limit on <span class="math inline">\(Cq_i\)</span> are recorded as the threshold value. For example, a <span class="math inline">\(\hat{Cq_i}\)</span> value of 42 is recorded as 40 when the upper limit is 40 cycles.</p>
<p>This model formulation makes several assumptions:</p>
<ul>
<li><p><span class="math inline">\(log[eDNA]\)</span> is assumed to be uniform within a sample.</p></li>
<li><p><span class="math inline">\(log[eDNA]\)</span> is sampled without error.</p></li>
<li><p>All measurement error is introduced in the extraction/qPCR stage. Field sampling is assumed to take place without error.*</p></li>
<li><p>There are no false detections, i.e. the measurement error cannot result in a positive detection when eDNA is not present in the sample.</p></li>
</ul>
<p><em><code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>Future versions of the <code>artemis</code> package might allow for measurement error in both the field collection and qPCR stages.</em></p>
<p>Importantly, this formulation produces estimates of the effect sizes which:</p>
<ul>
<li><p>are modeled directly on <span class="math inline">\(log[eDNA]\)</span> rather than Cq, <em>therefore are independent of the standard curve and can be compared between studies</em>.</p></li>
<li><p>account for the data truncation at the upper limit of qPCR cycles, <em>which reduces uncertainty and bias in the estimates.</em></p></li>
<li><p>directly model the measurement error on qPCR extraction, <em>allowing quantification of the amount of uncertainty attributable to uncertainty in the effect sizes vs. lab procedure.</em></p></li>
</ul>
<p>In <code>artemis</code>, the model is specified using a model formula, similar to the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> or <code>lmer()</code> functions. This model formula is used to construct the model on <span class="math inline">\(log[eDNA]\)</span>.</p>
<p>The functions in <code>artemis</code> generalize to any eDNA survey data containing Cq values associated with a standard curve for the target species.</p>
</div>
<div id="a-note-on-included-sample-data" class="section level2">
<h2 class="hasAnchor">
<a href="#a-note-on-included-sample-data" class="anchor"></a>A note on included sample data</h2>
<p>Since <code>artemis</code> was originally written to analyze aquatic eDNA samples, the examples and sample data included in the package (see <code><a href="../reference/eDNA_data.html">?eDNA_data</a></code>) reference variables that are specific to aquatic eDNA survey data. These variables include <code>volume</code> (the the number of mililiters of water that went through the filter in each sample) and <code>distance</code> (the distance in meters from the source of eDNA). For example, <code>eDNA_data</code> is from a “live car” experiment, where eDNA was sampled at known distances from a source of eDNA (fish in a net pen in unidirectional flow).</p>
<p>In the following examples, <code>tech_rep</code> refers to technical replicates extracted from a single eDNA sample; <code>rep</code> refers to a single eDNA sample.</p>
</div>
<div id="functions-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#functions-overview" class="anchor"></a>Functions overview</h2>
<p>The functions included in <code>artemis</code> can be grouped into a few categories:</p>
<ol style="list-style-type: decimal">
<li>Simulation of data</li>
<li>Conducting power or precision analysis</li>
<li>Modeling data</li>
<li>Conducting post-hoc analysis
<ul>
<li>including estimating the probability of detection, or generating predictions from model fits.</li>
</ul>
</li>
</ol>
<p>In addition to these functions, <code>artemis</code> includes methods for R’s <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>, and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> functions.</p>
</div>
<div id="simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#simulations" class="anchor"></a>Simulations</h2>
<p>One of the most basic tasks for the <code>artemis</code> package is simulating data. This data is simulated using the same data generation process as the model outlined above. Simulated data is useful for testing assumptions, designing a study, or doing a post-hoc analysis.</p>
<p>To simulate data, we first must provide a set of levels for each variable in your survey data. For example, if the hypothetical experiment had varying levels of the variables <code>distance</code>, <code>volume</code>, <code>tech_rep</code>, and <code>rep</code>, we would create a list with the variable names and the associated levels:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">vars =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Intercept =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">            <span class="dt">distance =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">            <span class="dt">volume =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">25</span>, <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">            <span class="dt">tech_rep =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">            <span class="dt">rep =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">            <span class="dt">Cq =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Notice that we provided a level for the intercept, as well as a dummy variable for the response. The response dummy variable (<code>Cq = 1</code> above) is only used internally to create the model matrix. By default, the simulation functions construct a model matrix assuming a complete block design (i.e. every level of each variable is represented).</p>
<p>Next, we must provide a set of effect sizes for each of the variables we have in the variable levels. For example, if we were only simulating data using distance and volume, we might specify the effect sizes as:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">betas =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.05</span>, <span class="dt">volume =</span> <span class="fl">0.02</span>)</a></code></pre></div>
<p>Again, it is important to remember that these are the effect sizes on <span class="math inline">\(log[eDNA]\)</span>, <em>not</em> on the Cq values themselves. All the parameters of the model are on the scale of <span class="math inline">\(log[eDNA]\)</span>, including the intercept. Hence, we specified the intercept to be -10, which corresponds to exp(-10)<span class="math inline">\([eDNA]\)</span>. (In practice, if the default value for log[eDNA] is close to 0, some a negative number less than -10 is a fair assumption for the intercept beta.)</p>
<p>Finally, to simulate data from a fixed-effects model, we use the <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">ans =<span class="st"> </span><span class="kw"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>distance <span class="op">+</span><span class="st"> </span>volume, </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                  <span class="dt">variable_list =</span> vars,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                  <span class="dt">betas =</span> betas,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                  <span class="dt">sigma_Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                  <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, </a>
<a class="sourceLine" id="cb3-7" data-line-number="7">                  <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>)</a></code></pre></div>
<p>Notice that we must provide the parameters from a standard curve equation for the conversion formula between <span class="math inline">\(log[eDNA]\)</span> and Cq values to the simulation function, as well as the measurement error on Cq (<code>sigma_Cq</code>).</p>
<p>You might have noticed that when we specified the <code>vars</code> above, we included many variables that we did not include in the formula. By design, all of the functions ignore extra variables in input variable_list or data (in the case of the modeling functions). This allows us to create a comprehensive list of variables we might be interested in, and then only adjust the model formula to change the simulations.</p>
<p>By default, the <code>sim_eDNA_*</code> functions will only simulate one instance of the hypothetical survey/experiment, but we can easily simulate many data sets in one go by adjusting the <code>n_sim</code> parameter, e.g.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">ans2 =<span class="st"> </span><span class="kw"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>distance <span class="op">+</span><span class="st"> </span>volume, </a>
<a class="sourceLine" id="cb4-2" data-line-number="2">                  vars,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                  <span class="dt">betas =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.05</span>, <span class="dt">volume =</span> <span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                  <span class="dt">sigma_Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                  <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                  <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                  <span class="dt">n_sim =</span> <span class="dv">500</span>)</a></code></pre></div>
<p>If we want to simulate data for an incomplete block design, we can specify our own variable data.frame, <code>X</code>, in which case the variable levels are ignored and the provided data frame is used to create a model matrix.</p>
<p>The returned object from the <code>sim_eDNA_*</code> functions is a list containing the latent variable <code>ln_conc</code>, the equivalent Cq value before truncation and measurement error <code>Cq_hat</code>, and the Cq value following the truncation and measurement error <code>Cq_star</code>. If n_sim = 1, you can convert the simulations to a dataframe by calling <code>as.data.frame</code> or <code>data.frame</code>. This can be useful when you wish to create custom plots of simulated data.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">simsdf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(ans)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(simsdf)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;   ln_conc  Cq_star X.Intercept. distance volume</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1  -10.10 35.72224            1        0     25</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 2  -10.85 38.13096            1       15     25</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; 3  -12.60 39.22541            1       50     25</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; 4   -9.60 35.74491            1        0     50</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; 5  -10.35 34.79865            1       15     50</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; 6  -12.10 39.46543            1       50     50</span></a></code></pre></div>
<p>When multiple simulations are requested, each of these will be stored in a matrix, with each column representing a single simulated instance.</p>
<p>To simulate for a mixed-effects model, we use the function <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer()</a></code>. Random effects are specified using the syntax of the <code>lme4</code> package, e.g. <code>(1|random effect)</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">ans3 =<span class="st"> </span><span class="kw"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer</a></span>(Cq <span class="op">~</span><span class="st"> </span>distance <span class="op">+</span><span class="st"> </span>volume <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>rep) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>tech_rep),</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">                     <span class="dt">variable_list =</span> vars,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                     <span class="dt">betas =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.05</span>, <span class="dt">volume =</span> <span class="fl">0.01</span>),</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                     <span class="dt">sigma_Cq =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                     <span class="dt">sigma_rand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="co">#stdev of the random effects</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                     <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                     <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>)</a></code></pre></div>
<p>When we are simulating data with random effects, we must provide the standard deviation of the random effects (one for each effect) in addition to the information for the fixed effects. Random effects are assumed to be generated from a normal distribution for these simulations using this standard deviation (<code>sigma_rand</code>). When <code>n_sims</code> &gt; 1, different random effects are generated for each simulation.</p>
<p>The results of a simulation can be inspected via the <code>summary</code> and <code>plot</code> methods. These can be helpful when assessing how realistic the simulated data are, and to test the assumptions behind the model and the betas used. For example, the results simulated for the fixed-effects model above can be summarized by calling:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(ans)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;      variable level     2.5%      50%    97.5%     mean  p_detect</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; 1 (Intercept)     1 34.61116 37.43483 40.00000 37.44409 0.8777778</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; 2    distance     0 34.22869 35.75370 37.82544 35.89816 1.0000000</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; 3    distance    15 34.93366 37.28147 38.59021 37.11066 1.0000000</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; 4    distance    50 37.72237 39.53702 40.00000 39.32344 0.6333333</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; 5      volume    25 35.17090 37.74466 40.00000 37.87296 0.8222222</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; 6      volume    50 34.16418 37.00682 40.00000 37.01521 0.9333333</span></a></code></pre></div>
<p>The default behavior of <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> is to give the empirical marginal distributions of the simulated data, i.e. the response summarized by each level of the variables used to simulate the data. <em>WARNING: these marginal effects can be misleading in cases where interactions are used in the formula.</em> The summary also includes an empirical summary of the percent of each level which was detected, i.e. had a Cq value below the threshold.</p>
<p>So in the output above, 95% of the simulated data with <code>distance</code> = 0 was between 28.2 and 34.8. The <code>p_detect</code> column is the percentage of each effect that was below the detection threshold. In this simulation, the intercept is pretty low and the effects of distance and volume are small. Most levels resulted in samples below the detection threshold.</p>
<p>The results of the simulations can be plotted with <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ans)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; [[3]]</span></a></code></pre></div>
<p><img src="artemis-overview_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="artemis-overview_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="artemis-overview_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<p>Similar to <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, this plots (in the same order as they appear in the formula) the marginal response (either Cq or <span class="math inline">\(log[eDNA]\)</span>) by each level of the variables used to simulate the data.</p>
</div>
<div id="power-and-precision-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#power-and-precision-functions" class="anchor"></a>Power and Precision Functions</h2>
<div id="evaluating-simulated-study-designs-with-the-power" class="section level3">
<h3 class="hasAnchor">
<a href="#evaluating-simulated-study-designs-with-the-power" class="anchor"></a>Evaluating Simulated Study Designs with the power</h3>
<p>Simulations are helpful for designing new studies. Given a set of assumptions about the effect sizes, we can simulate a full study and evaluate how well we are able to detect eDNA, and/or or whether the proposed design allows us to estimate those effects with precision.</p>
<p>For example, suppose we wanted to design a study exploring the effects of different distances on the detection of eDNA. From previous studies, we have estimated the effect of distance to be a -0.04 decrease in log[eDNA] per meter distance away from source. If we want to have a sense of how many replicates we need for this study to have at least 80% power (&gt;=80% chance of estimating a beta for distance without including 0 in its CI), we can do this using the <code><a href="../reference/est_power_lmer.html">est_power_lm()</a></code> and specifying a design. To do this, we specify the number of replicate filters as a vector (<code>rep</code>) in the <code>variable_list</code>, along with the rest of our variables and argument values. <em>Note that these functions are not yet parallelized and may take some time to run on your machine</em></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">dist_power =<span class="st"> </span><span class="kw"><a href="../reference/est_power_lmer.html">est_power_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>distance,</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                          <span class="dt">variable_list =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                                               <span class="dt">distance =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">300</span>), </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                                               <span class="dt">rep =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>),</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                          <span class="dt">betas =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.04</span>),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">                          <span class="dt">sigma_Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                          <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                          <span class="dt">type =</span> <span class="st">"exclude_zero"</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">dist_power</a></code></pre></div>
<p>It appears that 3 samples was not enough to estimate the effect of distance in this case. We could keep trying different number of replicates until we get the number we would like. However, it is easier to use the function <code><a href="../reference/est_power_range_lmer.html">est_power_range_lm()</a></code>, which will automate this process for us. The call is similar to the one above, but instead of specifying the number of replicates in the <code>variable_list</code>, we provide a <code>rep_range</code>, which is <code><a href="https://rdrr.io/r/base/seq.html">seq(2,20,2)</a></code> (every 2 from 2 to 20) by default. It will stop running once the specified power level is reached. Warning, this is quite CPU intensive, so for this demonstation, we will be lowering the <code>rep_range</code> and the number of iterations for each case:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">dist_power_range =<span class="st"> </span><span class="kw"><a href="../reference/est_power_range_lmer.html">est_power_range_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>distance,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                                <span class="dt">variable_list =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                                                     <span class="dt">distance =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">300</span>)),</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                                <span class="dt">betas =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.04</span>),</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                                <span class="dt">sigma_Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb10-7" data-line-number="7">                                <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">                                <span class="dt">type =</span> <span class="st">"exclude_zero"</span>,</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">                                <span class="dt">rep_range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>,<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">dist_power_range</a>
<a class="sourceLine" id="cb10-12" data-line-number="12"></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; $`n_rep: 5`</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; (Intercept)    distance </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;           1           0 </span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; $`n_rep: 10`</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; (Intercept)    distance </span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt;           1           1 </span></a></code></pre></div>
<p>For this study, it looks like we will need greater then 5 replicates (but perhaps less than 10) to have our desired 80% power.</p>
</div>
</div>
<div id="modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h2>
<p>The second purpose of the <code>artemis</code> package is to fit a model to collected data. Similar to the simulation functions, the <code>artemis</code> package has two functions which fit a Bayesian latent variable model to eDNA data; <code><a href="../reference/eDNA_lmer.html">eDNA_lm()</a></code> for fixed effects models and <code><a href="../reference/eDNA_lmer.html">eDNA_lmer()</a></code> for mixed effects models.</p>
<p>The syntax of these functions is similar to the simulation functions. We provide a model formula, a data frame with the observed data, and then the parameters for standard curve formula to convert between log[eDNA] and Cq values. For example, to fit a model to the sample data included in <code>artemis</code>, <code>eDNA_data</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">model_fit =<span class="st"> </span><span class="kw"><a href="../reference/eDNA_lmer.html">eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>Distance, eDNA_data,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">                    <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>)</a></code></pre></div>
<p>The modeling functions use <a href="mc-stan.org">Stan</a> to fit the Bayesian model. Full control of the MCMC algorithm can be accomplished by passing arguments to <code><a href="https://rdrr.io/pkg/rstan/man/stan.html">rstan::stan()</a></code> in the modeling functions. For example,</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">model_fit =<span class="st"> </span><span class="kw"><a href="../reference/eDNA_lmer.html">eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>Distance, eDNA_data,</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">                    <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                    <span class="dt">iter =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>By default, <code>artemis</code> suppresses the (often verbose) output from Stan, but users can (and should) enable it with <code>verbose = TRUE</code> when the model is slow or the output suggests the MCMC algorithm might not have converged, for example,</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">model_fit =<span class="st"> </span><span class="kw"><a href="../reference/eDNA_lmer.html">eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>Distance <span class="op">+</span><span class="st"> </span>Volume <span class="op">+</span><span class="st"> </span>Distance<span class="op">*</span>Volume, </a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                    <span class="dt">data =</span> eDNA_data,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                    <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                    <span class="dt">iter =</span> <span class="dv">300</span>, <span class="dt">n_chain =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">                    <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; SAMPLING FOR MODEL 'eDNA_lm' NOW (CHAIN 1).</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; Chain 1: Rejecting initial value:</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; Chain 1:   Log probability evaluates to log(0), i.e. negative infinity.</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; Chain 1:   Stan can't start sampling from this initial value.</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; Chain 1: Rejecting initial value:</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; Chain 1:   Log probability evaluates to log(0), i.e. negative infinity.</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; Chain 1:   Stan can't start sampling from this initial value.</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000192 seconds</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.92 seconds.</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; Chain 1: Iteration:   1 / 300 [  0%]  (Warmup)</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt; Chain 1: Iteration: 100 / 300 [ 33%]  (Warmup)</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; Chain 1: Iteration: 151 / 300 [ 50%]  (Sampling)</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt; Chain 1: Iteration: 250 / 300 [ 83%]  (Sampling)</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt; Chain 1: Iteration: 300 / 300 [100%]  (Sampling)</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt; Chain 1:  Elapsed Time: 0.296992 seconds (Warm-up)</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt; Chain 1:                0.212156 seconds (Sampling)</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt; Chain 1:                0.509148 seconds (Total)</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co">#&gt; SAMPLING FOR MODEL 'eDNA_lm' NOW (CHAIN 2).</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co">#&gt; Chain 2: Rejecting initial value:</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">#&gt; Chain 2:   Log probability evaluates to log(0), i.e. negative infinity.</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="co">#&gt; Chain 2:   Stan can't start sampling from this initial value.</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"><span class="co">#&gt; Chain 2: </span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36"><span class="co">#&gt; Chain 2: Gradient evaluation took 0.000115 seconds</span></a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 1.15 seconds.</span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38"><span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span></a>
<a class="sourceLine" id="cb13-39" data-line-number="39"><span class="co">#&gt; Chain 2: </span></a>
<a class="sourceLine" id="cb13-40" data-line-number="40"><span class="co">#&gt; Chain 2: </span></a>
<a class="sourceLine" id="cb13-41" data-line-number="41"><span class="co">#&gt; Chain 2: Iteration:   1 / 300 [  0%]  (Warmup)</span></a>
<a class="sourceLine" id="cb13-42" data-line-number="42"><span class="co">#&gt; Chain 2: Iteration: 100 / 300 [ 33%]  (Warmup)</span></a>
<a class="sourceLine" id="cb13-43" data-line-number="43"><span class="co">#&gt; Chain 2: Iteration: 151 / 300 [ 50%]  (Sampling)</span></a>
<a class="sourceLine" id="cb13-44" data-line-number="44"><span class="co">#&gt; Chain 2: Iteration: 250 / 300 [ 83%]  (Sampling)</span></a>
<a class="sourceLine" id="cb13-45" data-line-number="45"><span class="co">#&gt; Chain 2: Iteration: 300 / 300 [100%]  (Sampling)</span></a>
<a class="sourceLine" id="cb13-46" data-line-number="46"><span class="co">#&gt; Chain 2: </span></a>
<a class="sourceLine" id="cb13-47" data-line-number="47"><span class="co">#&gt; Chain 2:  Elapsed Time: 0.339952 seconds (Warm-up)</span></a>
<a class="sourceLine" id="cb13-48" data-line-number="48"><span class="co">#&gt; Chain 2:                0.255316 seconds (Sampling)</span></a>
<a class="sourceLine" id="cb13-49" data-line-number="49"><span class="co">#&gt; Chain 2:                0.595268 seconds (Total)</span></a>
<a class="sourceLine" id="cb13-50" data-line-number="50"><span class="co">#&gt; Chain 2:</span></a></code></pre></div>
<p>To fit a model with a random effect, use the <code><a href="../reference/eDNA_lmer.html">eDNA_lmer()</a></code> function and specify the random effects using the syntax used by <code>lme4</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">model_fit2 =<span class="st"> </span><span class="kw"><a href="../reference/eDNA_lmer.html">eDNA_lmer</a></span>(Cq <span class="op">~</span><span class="st"> </span>Distance <span class="op">+</span><span class="st"> </span>Volume <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>SampleID),</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">                       eDNA_data,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                       <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>)</a></code></pre></div>
<p>As with the simulations, the model results can be summarized with <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> and can be plotted with <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>,</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_fit)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">#&gt;                          mean          2.5%           50%         97.5%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; (Intercept)     -1.108083e+01 -1.169717e+01 -1.106895e+01 -1.047305e+01</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt; Distance        -3.240842e-02 -4.258832e-02 -3.234939e-02 -2.288818e-02</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; Volume           1.397507e-02  2.109735e-03  1.380098e-02  2.580679e-02</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">#&gt; Distance:Volume -6.957109e-05 -2.146604e-04 -6.642794e-05  6.099628e-05</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; CQ sd            3.810139e+00  3.529423e+00  3.801063e+00  4.140466e+00</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(model_fit, <span class="dt">pars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"betas[%d]"</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)))</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; ci_level: 0.8 (80% intervals)</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; outer_level: 0.95 (95% intervals)</span></a></code></pre></div>
<p><img src="artemis-overview_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div id="post-hoc-analyses-pdetect" class="section level2">
<h2 class="hasAnchor">
<a href="#post-hoc-analyses-pdetect" class="anchor"></a>Post-hoc analyses p(detect)</h2>
<p>Often purpose of a eDNA sampling study is to inform a field sampling protocol. For these cases, we often want to know how likely we are to detect eDNA, given the way that we sampled. <code><a href="../reference/est_p_detect.html">est_p_detect()</a></code> returns the probability of getting a detection across all planned samples and replicates, where <code>n_rep</code> represents the product of the number of filters and technical replicates for each filter. For example, if you planned to take 2-5 filters at each variable level and then complete 6 extractions for each filter, that would be <code>n_rep = 12:30</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">p_detect =<span class="st"> </span><span class="kw"><a href="../reference/est_p_detect.html">est_p_detect</a></span>(<span class="dt">variable_levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">Intercept =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                                            <span class="dt">Distance =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">                        <span class="dt">betas =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">Intercept =</span> <span class="fl">-10.5</span>, <span class="dt">Distance =</span> <span class="fl">-0.03</span>),</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">                        <span class="dt">Cq_sd =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb16-5" data-line-number="5">                        <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">                        <span class="dt">n_rep =</span> <span class="dv">12</span><span class="op">:</span><span class="dv">30</span>)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">p_detect</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; Variable levels: </span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; Intercept  Distance </span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt;         1       100 </span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt;    n_reps  p_detect</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; 1      12 0.6000732</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; 2      13 0.6294795</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; 3      14 0.6567236</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; 4      15 0.6819645</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; 5      16 0.7053494</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; 6      17 0.7270148</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt; 7      18 0.7470872</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt; 8      19 0.7656837</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt; 9      20 0.7829128</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="co">#&gt; 10     21 0.7988751</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt; 11     22 0.8136637</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt; 12     23 0.8273648</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt; 13     24 0.8400586</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt; 14     25 0.8518189</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt; 15     26 0.8627146</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt; 16     27 0.8728091</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt; 17     28 0.8821613</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt; 18     29 0.8908259</span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31"><span class="co">#&gt; 19     30 0.8988534</span></a></code></pre></div>
<p>We can also plot this,</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(p_detect)</a></code></pre></div>
<p><img src="artemis-overview_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Alternatively, we can also use a fit model to estimate the p(detect) for a set of circumstances. Unlike the above, using a fit model allows us to estimate the probability of detection with the uncertainty in our effect size estimates taken into account.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">p_detect2 =<span class="st"> </span><span class="kw"><a href="../reference/est_p_detect.html">est_p_detect</a></span>(<span class="dt">variable_levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">Intercept =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb18-2" data-line-number="2">                                             <span class="dt">Distance =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                                             <span class="dt">Volume =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                                             <span class="dt">DistanceXVolume =</span> <span class="dv">100</span><span class="op">*</span><span class="dv">50</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                                             ),</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">                        <span class="dt">model_fit =</span> model_fit, </a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                        <span class="dt">n_rep =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8"></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(p_detect2)</a></code></pre></div>
<p>and we can plot the results,</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(p_detect2, <span class="dt">error_width =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p>Notice how we get uncertainty intervals when we use a fit model.</p>
</div>
<div id="predicting-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#predicting-outcomes" class="anchor"></a>Predicting outcomes</h2>
<p>Once a model is fit, it can be helpful to predict the outcome, either for the data used to fit the model or new data. For this, <code>artemis</code> provides methods for <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> for models fit with <code>eDNA_lm*()</code>. This prediction process is very closely related to simulating data with fixed effect sizes.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#a-note-on-included-sample-data">A note on included sample data</a></li>
      <li><a href="#functions-overview">Functions overview</a></li>
      <li><a href="#simulations">Simulations</a></li>
      <li><a href="#power-and-precision-functions">Power and Precision Functions</a></li>
      <li><a href="#modeling">Modeling</a></li>
      <li><a href="#post-hoc-analyses-pdetect">Post-hoc analyses p(detect)</a></li>
      <li><a href="#predicting-outcomes">Predicting outcomes</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Myfanwy Johnston, Matt Espe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
