<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating eDNA Data with `artemis` • artemis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating eDNA Data with `artemis`">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">artemis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/artemis-installation-guide.html">ARTEMIS Installation Guide</a>
    </li>
    <li>
      <a href="../articles/artemis-overview.html">Getting started with the artemis package</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating eDNA Data with `artemis`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Simulating eDNA Data with <code>artemis</code>
</h1>
            
      
      
      <div class="hidden name"><code>simulation.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(artemis)</a></code></pre></div>
<p><br></p>
<p>Simulating data is extremely useful. It’s like a sandbox to play and practice in without the anxiety of wasting resources, allowing us to test assumptions, visualize model relationships, and conduct power analyses on hypothetical experiments.</p>
<p><br></p>
<p>The <code>artemis</code> package includes two flexible functions for simulating data: <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code> and <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer()</a></code>. These functions use the same data generation process outlined in the <a href="https://fishsciences.github.io/artemis/articles/artemis-overview.html">Getting Started with <code>artemis</code> vignette</a>).</p>
<p>In the sections that follow, we will go through the three steps of the data simulation process in <code>artemis</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Creating a list of predictor variables and their levels</p></li>
<li><p>Creating a vector of beta values for each predictor variable</p></li>
<li><p>Calling the <code>sim_eDNA_*()</code> functions to simulate data, depending on the structure of the model (fixed or mixed effects).</p></li>
</ol>
<p>Once generated, simulations can be stored as an object in R. We can manipulate, summarize, and plot them.</p>
<div id="step-1--create-a-variable-list" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1--create-a-variable-list" class="anchor"></a>Step 1. Create a variable list</h3>
<p>In order to simulate data, we first must provide a list of variables in our survey data and their associated levels. For example, if the hypothetical survey or experiment had varying levels of the variables <code>distance</code>, <code>volume</code>,<code>tech_rep</code>, and <code>rep</code>, we might create the following complete list of variables:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">vars =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Cq =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">            <span class="dt">Intercept =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">            <span class="dt">distance =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">            <span class="dt">volume =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">25</span>, <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">            <span class="dt">tech_rep =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">            <span class="dt">rep =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<p>There is nothing special about the names used here, other than that they must be matched in the formula eventually expressed in <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code>. The variables can have as many levels as we like, and be categorical or continuous (we would wrap categorical variables with <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code>).</p>
<p>We included two dummy variables in our list: one for the response (“<code>Cq</code>”), and one for the intercept. The response dummy variable is used internally by the simulation functions to create the model matrix. We could have omitted the intercept variable here, but the <code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> function that gets called downstream will create one by default, so it’s good practice to include it in our variable list.</p>
</div>
<div id="step-2--provide-effect-sizes" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2--provide-effect-sizes" class="anchor"></a>Step 2. Provide effect sizes</h3>
<p>Next, we must provide effect sizes (<code>betas</code>) for the variables we we plan to include in the model formula. The values we assign the <code>betas</code> will no doubt depend on our reasons for doing the simulation. If we have previous model results for the effects of distance and volume, for example, we might use those for our <code>betas</code> vector:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">betas =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.05</span>, <span class="dt">volume =</span> <span class="fl">0.02</span>)</a></code></pre></div>
<p>By default, the first beta value in <code>betas</code> will be considered the term for the intercept. The names of the <code>betas</code> don’t need to be the same as they are in the <code>vars</code> list or the model formula expression, but the <code>sim_eDNA_*()</code> functions do reference the <code>betas</code> vector with respect to the model formula, so the <em>order</em> of the variables does need to match, and we need one beta for each predictor in the model formula.</p>
<p>When specifying the <code>betas</code> values, it helps to remember that all the model parameters are on the scale of <span class="math inline">\(log[eDNA]\)</span>, including the intercept. Here we specified the intercept to be -10, which came from previous modeling results but also corresponds to <code><a href="https://rdrr.io/r/base/Log.html">exp(-10)</a></code><span class="math inline">\([eDNA]\)</span>. This is a very small number, and thus a proxy for eDNA that is very rare in the environment before any covariates are considered. Often if we’re getting simulation results we find bizarre or surprising, the scale of the <code>betas</code> is the place to start debugging.</p>
</div>
<div id="step-3--call-the-sim_edna_-functions-to-simulate-data" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3--call-the-sim_edna_-functions-to-simulate-data" class="anchor"></a>Step 3. Call the <code>sim_eDNA_*()</code> functions to simulate data</h3>
<p>With our variable list and our <code>betas</code> decided upon we’re ready to simulate data! For fixed-effects variables, we use the <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code> function. This function takes a model formula (with syntax identical to that used in the <code>lme4</code> package), the variable list and the <code>betas</code> vector, but it also requires the parameters from a standard curve equation for the conversion formula between <span class="math inline">\(log[eDNA]\)</span> and Cq values to the simulation function, as well as the measurement error on Cq (<code>sigma_Cq</code>):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">ans =<span class="st"> </span><span class="kw"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>distance <span class="op">+</span><span class="st"> </span>volume, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                  <span class="dt">variable_list =</span> vars,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                  <span class="dt">betas =</span> betas,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                  <span class="dt">sigma_Cq =</span> <span class="fl">1.5</span>, </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                  <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                  <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>)</a></code></pre></div>
<p>The returned object from the <code>sim_eDNA_*</code> functions is a list containing the latent variable <code>ln_conc</code>, the equivalent Cq value before truncation and measurement error <code>Cq_hat</code>, and the estimated Cq value following the truncation and measurement error <code>Cq_star</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(ans, <span class="dt">max.level =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Formal class 'eDNA_simulation' [package "artemis"] with 9 slots</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;   ..@ ln_conc        : num [1, 1:180] -10.1 -10.8 -12.6 -9.6 -10.3 ...</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;   ..@ Cq_star        : num [1, 1:180] 35.4 38.5 38.8 35.8 33.8 ...</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;   ..@ formula        :Class 'formula'  language Cq ~ distance + volume</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;   .. .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;   ..@ variable_levels:List of 6</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;   .. ..$ Cq       : num 1</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;   .. ..$ Intercept: num 1</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;   .. ..$ distance : num [1:3] 0 15 50</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;   .. ..$ volume   : num [1:2] 25 50</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;   .. ..$ tech_rep : int [1:10] 1 2 3 4 5 6 7 8 9 10</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;   .. ..$ rep      : int [1:3] 1 2 3</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt;   ..@ betas          : Named num [1:3] -10.6 -0.05 0.02</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:3] "intercept" "distance" "volume"</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt;   ..@ x              :'data.frame':  180 obs. of  3 variables:</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;   .. ..$ (Intercept): num [1:180] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;   .. ..$ distance   : num [1:180] 0 15 50 0 15 50 0 15 50 0 ...</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt;   .. ..$ volume     : num [1:180] 25 25 25 50 50 50 25 25 25 50 ...</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt;   ..@ std_curve_alpha: num 21.2</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt;   ..@ std_curve_beta : num -1.5</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt;   ..@ upper_Cq       : num 40</span></a></code></pre></div>
<p>We can inspect empirical summaries of marginal distributions in the simulations with <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(ans)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt;      variable level  2.5%   50% 97.5%  mean p_detect</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; 1 (Intercept)     1 33.96 37.57 40.00 37.36   0.8667</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; 2    distance     0 33.54 35.70 38.56 35.86   1.0000</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; 3    distance    15 34.04 37.41 39.15 37.11   0.9833</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; 4    distance    50 36.71 39.55 40.00 39.10   0.6167</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; 5      volume    25 34.58 37.92 40.00 37.83   0.8111</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; 6      volume    50 33.45 37.20 40.00 36.89   0.9222</span></a></code></pre></div>
<p>…which summarizes the response (Cq on its natural scale) across each level of the variables used to simulate the data.</p>
<p><strong><em>WARNING</em></strong>: <em>these marginal effects can be misleading in cases where interactions are simulated; if you have interaction effects, additional analysis is recommended.</em></p>
<p>The last column of the table returned by <code>summary</code> is the percent of observations that represented positive detections, i.e. a Cq value below the upper cycle threshold for non-detection (set to 40 by default). In the output above, 100% of the simulated data with <code>distance</code> = 0 was below 40.0.</p>
</div>
<div id="simulating-many-many-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-many-many-datasets" class="anchor"></a>Simulating many many datasets</h2>
<p>By default, the <code>sim_eDNA_*</code> functions will only simulate one instance of the hypothetical survey/experiment, but we can easily simulate many datasets by adjusting the <code>n_sim</code> parameter. This becomes especially useful when we want to do power analyses on simulated results.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">ans2 =<span class="st"> </span><span class="kw"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm</a></span>(Cq <span class="op">~</span><span class="st"> </span>distance <span class="op">+</span><span class="st"> </span>volume, </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">                  <span class="dt">variable_list =</span> vars,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">                  <span class="dt">betas =</span> betas,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                  <span class="dt">sigma_Cq =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb7-5" data-line-number="5">                  <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>, </a>
<a class="sourceLine" id="cb7-6" data-line-number="6">                  <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>,</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">                  <span class="dt">n_sim =</span> <span class="dv">500</span>) <span class="co"># specifies the number of simulated datasets to generate</span></a></code></pre></div>
<p>When multiple simulations are requested, each of these will be stored in a matrix, with each column representing a single simulated instance.</p>
</div>
<div id="plotting-simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-simulated-data" class="anchor"></a>Plotting simulated data</h2>
<p>The results of the simulations can be plotted with <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ans)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; [[3]]</span></a></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="simulation_files/figure-html/unnamed-chunk-8-2.png" width="700"><img src="simulation_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<p><br></p>
<p>Similar to <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, each plot panel shows the marginal distribution of the response (either Cq or <span class="math inline">\(log[eDNA]\)</span>) across the levels of the variables used to simulate the data.</p>
<div id="creating-custom-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-custom-plots" class="anchor"></a>Creating custom plots</h3>
<p><code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> is a generic method intended for quick visualization of simulations. When we wish to create custom plots, we can convert a simulated dataset to a <code>dataframe</code> by calling <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> or <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> on the simulation object, and then plot them with our method of choice. Here is an example using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">simsdf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(ans)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co"># custom plot of simulated data</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">ggplot</span>(simsdf, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(distance), <span class="dt">y =</span> Cq_star)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(volume)), <span class="dt">width =</span> <span class="fl">0.05</span>, <span class="dt">alpha =</span> <span class="fl">0.65</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">   </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Distance (m)"</span>, <span class="dt">y =</span> <span class="st">"Estimated Cq"</span>)</a></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p><br></p>
</div>
</div>
<div id="simulating-data-from-mixed-effects-models" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-data-from-mixed-effects-models" class="anchor"></a>Simulating data from mixed effects models</h2>
<p>To simulate from a mixed-effects model, we use the function <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer()</a></code>. Random effects are specified using the syntax of the <code>lme4</code> package, e.g. <code>(1|random effect)</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">ans3 =<span class="st"> </span><span class="kw"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer</a></span>(Cq <span class="op">~</span><span class="st"> </span>distance <span class="op">+</span><span class="st"> </span>volume <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>rep) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>tech_rep),</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">                     <span class="dt">variable_list =</span> vars,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                     <span class="dt">betas =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">intercept =</span> <span class="fl">-10.6</span>, <span class="dt">distance =</span> <span class="fl">-0.05</span>, <span class="dt">volume =</span> <span class="fl">0.01</span>),</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                     <span class="dt">sigma_Cq =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                     <span class="dt">sigma_rand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="co">#stdev of the random effects</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                     <span class="dt">std_curve_alpha =</span> <span class="fl">21.2</span>,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">                     <span class="dt">std_curve_beta =</span> <span class="fl">-1.5</span>)</a></code></pre></div>
<p>When we are simulating data with random effects, we must provide the standard deviation of the random effects (<code>sigma_rand</code>, a vector containing one value for each random effect <code>beta</code>), in addition to the information for the fixed effects.</p>
<p>Random effects are assumed to be generated from a normal distribution for these simulations using this standard deviation (<code>sigma_rand</code>). When <code>n_sims</code> &gt; 1, different random effects are generated for each simulation.</p>
</div>
<div id="final-notes-on-the-simulation-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#final-notes-on-the-simulation-functions" class="anchor"></a>Final notes on the simulation functions</h2>
<p>By default, the simulation functions construct a model matrix assuming a complete block design (i.e. every level of each variable is represented). If we want to simulate data for an incomplete block design, we can specify our own variable <code>data.frame</code>, <code>X</code>, to create a model matrix.</p>
<p><br></p>
<p>When we specified the <code>vars</code> above, we included many variables that we did not use in the formula. By design, the simulation and modeling functions ignore extra variables in the <code>variable_list</code> or <code>data</code> inputs. This is just a workflow perk; it allows us to create a comprehensive list of variables we might be interested in, and then we only need adjust the model formula to change the simulations.</p>
<p><br></p>
<p>Sometimes we get simulation results that seem very surprising, and often our first instinct is to suspect the model. When this happens, it can be helpful to remember that the model underlying the simulation functions is highly deterministic to the expected value - which is to say that barring any bugs in the code, there is no stochasticity in the calculations that <code>artemis</code> performs; they are mathematically sound when the pieces are right. There is a random component in simulating the random error, but even that should play out predictably for us. Thus if we’re getting surprising or nonsensical simulations, the trouble probably lies with the assumptions or the data we provided to the model. When we go to look for the source of the unexpected behavior, then, the input data is almost always the best place to start.</p>
<p><br><br><br> — <br><br></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulating-many-many-datasets">Simulating many many datasets</a></li>
      <li><a href="#plotting-simulated-data">Plotting simulated data</a></li>
      <li><a href="#simulating-data-from-mixed-effects-models">Simulating data from mixed effects models</a></li>
      <li><a href="#final-notes-on-the-simulation-functions">Final notes on the simulation functions</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Myfanwy Johnston, Matt Espe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
