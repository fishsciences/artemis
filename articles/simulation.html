<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating eDNA Data with `artemis` • artemis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating eDNA Data with `artemis`">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">artemis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/artemis-overview.html">Getting started with the artemis package</a>
    </li>
    <li>
      <a href="../articles/background.html">The motivation behind the artemis package</a>
    </li>
    <li>
      <a href="../articles/count_modeling.html">Modeling count eDNA qPCR Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/model_types.html">Models included in the `artemis` package and when to use them</a>
    </li>
    <li>
      <a href="../articles/modeling.html">Modeling eDNA qPCR Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating eDNA Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/zero_inflated.html">Modeling Zero-Inflated eDNA qPCR Data with `artemis`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulating eDNA Data with <code>artemis</code>
</h1>
            
      

      <div class="hidden name"><code>simulation.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">artemis</span><span class="op">)</span></span></code></pre></div>
<p>(Adapted from manuscript Espe et al, in preparation)</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Simulating data is extremely useful. It’s like a sandbox to play and practice in, allowing us to test assumptions, visualize model relationships, and conduct power analyses on hypothetical experiments.</p>
<p>The <code>artemis</code> package includes two flexible functions for simulating data: <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code> and <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer()</a></code>. These functions use the same data generation process outlined in the <a href="https://fishsciences.github.io/artemis/articles/artemis-overview.html" class="external-link">Getting Started with <code>artemis</code> vignette</a>.</p>
<p>In this vignette, we will work through the three main steps of the data simulation process in <code>artemis</code>, and show how the results of data simulation can be stored, summarized, and plotted.</p>
<div class="section level3">
<h3 id="step-1--create-a-list-of-variables">Step 1. Create a list of variables<a class="anchor" aria-label="anchor" href="#step-1--create-a-list-of-variables"></a>
</h3>
<p>In order to simulate data, we first must provide a list of variables and their associated levels. For example, if the hypothetical survey or experiment had varying levels of the variables <code>distance</code>, <code>volume</code>,<code>tech_rep</code>, and <code>rep</code>, we might create the following complete list of variables:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Cq <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            Intercept <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>            volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>            tech_rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>            rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>There is nothing special about the names used here, other than that they must be matched in the formula eventually expressed in <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code>. The variables can have as many levels as we like, and be categorical or continuous (we would wrap categorical variables with <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code>).</p>
<p>We included two dummy variables in our list: one for the response (“<code>Cq</code>”), and one for the intercept. The response dummy variable is used internally by the simulation functions to create the model matrix. We could have omitted the intercept variable here, but the <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> function that gets called downstream will create one by default, so it’s good practice to include it in our variable list.</p>
</div>
<div class="section level3">
<h3 id="step-2--provide-effect-sizes">Step 2. Provide effect sizes<a class="anchor" aria-label="anchor" href="#step-2--provide-effect-sizes"></a>
</h3>
<p>Next, we must provide effect sizes (<code>betas</code>) for the variables we plan to include in the model formula. The values we assign the <code>betas</code> will no doubt depend on our reasons for doing the simulation. If we have previous model results for the effects of distance and volume, for example, we might use those for our <code>betas</code> vector:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="op">-</span><span class="fl">10.6</span>, distance <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span>, volume <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span></code></pre></div>
<p>By default, the first beta value in <code>betas</code> will be considered the term for the intercept. The names of the <code>betas</code> don’t need to be the same as they are in the <code>vars</code> list above, or even the model formula expression, but the <code>sim_eDNA_*()</code> functions do reference the <code>betas</code> vector with respect to the model formula. This means that it’s the <em>order</em> of the variables between the <code>betas</code> vector and the model formula that needs to match, and that there needs to be one beta for each predictor in the model formula.</p>
<p>When specifying the <code>betas</code> values, it helps to remember that all the model parameters are on the scale of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false" form="prefix">[</mo><mi>e</mi><mi>D</mi><mi>N</mi><mi>A</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">log[eDNA]</annotation></semantics></math>, including the intercept. Here we specified the intercept to be -10, which came from previous modeling results but also corresponds to <code>exp(-10)</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><mi>e</mi><mi>D</mi><mi>N</mi><mi>A</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[eDNA]</annotation></semantics></math>. This is a very small number, and thus a proxy for eDNA that is very rare in the environment before any covariates are considered. Often if we’re getting simulation results we find bizarre or surprising, the scale of the <code>betas</code> is the place to start debugging.</p>
</div>
<div class="section level3">
<h3 id="step-3--call-the-sim_edna_-functions-to-simulate-data">Step 3. Call the <code>sim_eDNA_*()</code> functions to simulate data<a class="anchor" aria-label="anchor" href="#step-3--call-the-sim_edna_-functions-to-simulate-data"></a>
</h3>
<p>With our variable list and <code>betas</code> decided, we’re ready to simulate data! For fixed-effects variables, we use the <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm()</a></code> function. This function takes a model formula (with syntax identical to that used in the <code>lme4</code> package), the variable list and the <code>betas</code> vector, but it also requires the parameters from a standard curve equation for the conversion formula between <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false" form="prefix">[</mo><mi>e</mi><mi>D</mi><mi>N</mi><mi>A</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">log[eDNA]</annotation></semantics></math> and Cq values to the simulation function, as well as the measurement error on Cq (<code>sigma_ln_eDNA</code>):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm</a></span><span class="op">(</span><span class="va">Cq</span> <span class="op">~</span> <span class="va">distance</span> <span class="op">+</span> <span class="va">volume</span>, </span>
<span>                  variable_list <span class="op">=</span> <span class="va">vars</span>,</span>
<span>                  betas <span class="op">=</span> <span class="va">betas</span>,</span>
<span>                  sigma_ln_eDNA <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>                  std_curve_alpha <span class="op">=</span> <span class="fl">21.2</span>, </span>
<span>                  std_curve_beta <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p>The returned object from the <code>sim_eDNA_*</code> functions isan object of class “eDNA_simulation”, which is essentially a list containing: 1) the latent variable <code>ln_conc</code>, 2) the equivalent Cq value before truncation and measurement error <code>Cq_hat</code>, and 3) the estimated Cq value following the truncation and measurement error <code>Cq_star</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ans</span>, max.level <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formal class 'eDNA_simulation' [package "artemis"] with 10 slots</span></span>
<span><span class="co">#&gt;   ..@ ln_conc_hat    : num [1:180, 1] -8.64 -11.06 -12.07 -7.8 -5.86 ...</span></span>
<span><span class="co">#&gt;   ..@ ln_conc_star   : num [1:180, 1] -10.1 -10.8 -12.6 -9.6 -10.3 ...</span></span>
<span><span class="co">#&gt;   ..@ Cq_star        : num [1:180, 1] 34.2 37.8 39.3 32.9 30 ...</span></span>
<span><span class="co">#&gt;   ..@ formula        :Class 'formula'  language Cq ~ distance + volume</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; </span></span>
<span><span class="co">#&gt;   ..@ variable_levels:List of 6</span></span>
<span><span class="co">#&gt;   .. ..$ Cq       : num 1</span></span>
<span><span class="co">#&gt;   .. ..$ Intercept: num 1</span></span>
<span><span class="co">#&gt;   .. ..$ distance : num [1:3] 0 15 50</span></span>
<span><span class="co">#&gt;   .. ..$ volume   : num [1:2] 25 50</span></span>
<span><span class="co">#&gt;   .. ..$ tech_rep : int [1:10] 1 2 3 4 5 6 7 8 9 10</span></span>
<span><span class="co">#&gt;   .. ..$ rep      : int [1:3] 1 2 3</span></span>
<span><span class="co">#&gt;   ..@ betas          : Named num [1:3] -10.6 -0.05 0.02</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:3] "intercept" "distance" "volume"</span></span>
<span><span class="co">#&gt;   ..@ x              :'data.frame':  180 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   .. ..$ (Intercept): num [1:180] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   .. ..$ distance   : num [1:180] 0 15 50 0 15 50 0 15 50 0 ...</span></span>
<span><span class="co">#&gt;   .. ..$ volume     : num [1:180] 25 25 25 50 50 50 25 25 25 50 ...</span></span>
<span><span class="co">#&gt;   ..@ std_curve_alpha: num 21.2</span></span>
<span><span class="co">#&gt;   ..@ std_curve_beta : num -1.5</span></span>
<span><span class="co">#&gt;   ..@ upper_Cq       : num 40</span></span></code></pre></div>
<p>We can inspect empirical summaries of marginal distributions in the simulations with <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span><span class="co">#&gt;      variable level     2.5%      50% 97.5%     mean  p_detect</span></span>
<span><span class="co">#&gt; 1 (Intercept)     1 32.43618 38.12105    40 37.51921 0.7277778</span></span>
<span><span class="co">#&gt; 2    distance     0 31.36924 36.34685    40 36.59825 0.8333333</span></span>
<span><span class="co">#&gt; 3    distance    15 33.14563 37.06390    40 36.88183 0.8500000</span></span>
<span><span class="co">#&gt; 4    distance    50 36.23754 39.84630    40 39.07753 0.5000000</span></span>
<span><span class="co">#&gt; 5      volume    25 32.86639 38.41530    40 37.81321 0.7000000</span></span>
<span><span class="co">#&gt; 6      volume    50 32.43151 37.68230    40 37.22520 0.7555556</span></span></code></pre></div>
<p>…which summarizes the response (Cq on its natural scale) across each level of the variables used to simulate the data.</p>
<p><strong><em>WARNING</em></strong>: <em>these marginal effects can be misleading in cases where interactions are simulated; if you have interaction effects, additional analysis is recommended.</em></p>
<p>The last column of the table returned by <code>summary</code> is the percent of observations that represented positive detections, i.e. a Cq value below the upper cycle threshold for non-detection (set to 40 by default). In the output above, 93% of the simulated data with <code>distance</code> = 0 was below 40.0.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-many-many-datasets">Simulating many many datasets<a class="anchor" aria-label="anchor" href="#simulating-many-many-datasets"></a>
</h2>
<p>By default, the <code>sim_eDNA_*</code> functions will only simulate one instance of the hypothetical survey/experiment, but we can easily simulate many datasets by adjusting the <code>n_sim</code> parameter. This becomes especially useful when we want to do power analyses on simulated results.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ans2</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lm</a></span><span class="op">(</span><span class="va">Cq</span> <span class="op">~</span> <span class="va">distance</span> <span class="op">+</span> <span class="va">volume</span>, </span>
<span>                  variable_list <span class="op">=</span> <span class="va">vars</span>,</span>
<span>                  betas <span class="op">=</span> <span class="va">betas</span>,</span>
<span>                  sigma_ln_eDNA <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  std_curve_alpha <span class="op">=</span> <span class="fl">21.2</span>, </span>
<span>                  std_curve_beta <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span>
<span>                  n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># specifies the number of simulated datasets to generate</span></span></code></pre></div>
<p>When multiple simulations are requested, each of these will be stored in a matrix, with each column representing a single simulated instance.</p>
</div>
<div class="section level2">
<h2 id="plotting-simulated-data">Plotting simulated data<a class="anchor" aria-label="anchor" href="#plotting-simulated-data"></a>
</h2>
<p>The results of the simulations can be plotted with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, jitter_width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="simulation_files/figure-html/unnamed-chunk-8-2.png" width="700"><img src="simulation_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<p><br></p>
<p>Similar to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, each plot panel shows the marginal distribution of the response (either Cq or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false" form="prefix">[</mo><mi>e</mi><mi>D</mi><mi>N</mi><mi>A</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">log[eDNA]</annotation></semantics></math>) across the levels of the variables used to simulate the data.</p>
<div class="section level3">
<h3 id="creating-custom-plots">Creating custom plots<a class="anchor" aria-label="anchor" href="#creating-custom-plots"></a>
</h3>
<p><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> is a generic method intended for quick visualization of simulations. When we wish to create custom plots, we can convert a simulated dataset to a <code>dataframe</code> by calling <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> or <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> on the simulation object, and then plot them with our method of choice. Here is an example using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simsdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># custom plot of simulated data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simsdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">Cq_star</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              width <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               width <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Distance (m)"</span>, y <span class="op">=</span> <span class="st">"Estimated Cq"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-data-from-mixed-effects-models">Simulating data from mixed effects models<a class="anchor" aria-label="anchor" href="#simulating-data-from-mixed-effects-models"></a>
</h2>
<p>To simulate from a mixed-effects model, we use the function <code><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer()</a></code>. Random effects are specified using the syntax of the <code>lme4</code> package, e.g. <code>(1|random effect)</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ans3</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_eDNA_lmer.html">sim_eDNA_lmer</a></span><span class="op">(</span><span class="va">Cq</span> <span class="op">~</span> <span class="va">distance</span> <span class="op">+</span> <span class="va">volume</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">rep</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">tech_rep</span><span class="op">)</span>,</span>
<span>                     variable_list <span class="op">=</span> <span class="va">vars</span>,</span>
<span>                     betas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="op">-</span><span class="fl">10.6</span>, distance <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span>, volume <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                     sigma_ln_eDNA <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     sigma_rand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="co">#stdev of the random effects</span></span>
<span>                     std_curve_alpha <span class="op">=</span> <span class="fl">21.2</span>,</span>
<span>                     std_curve_beta <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p>When we are simulating data with random effects, we must provide the standard deviation of the random effects (<code>sigma_rand</code>, a vector containing one value for each random effect <code>beta</code>), in addition to the information for the fixed effects.</p>
<p>Random effects are assumed to be generated from a normal distribution for these simulations using this standard deviation (<code>sigma_rand</code>). When <code>n_sims</code> &gt; 1, different random effects are generated for each simulation.</p>
</div>
<div class="section level2">
<h2 id="final-notes-on-the-simulation-functions">Final notes on the simulation functions<a class="anchor" aria-label="anchor" href="#final-notes-on-the-simulation-functions"></a>
</h2>
<p>By default, the simulation functions construct a model matrix assuming a complete block design (i.e. every level of each variable is represented). If we want to simulate data for an incomplete block design, we can specify our own variable <code>data.frame</code>, <code>X</code>, to create a model matrix.</p>
<p><br></p>
<p>When we specified the <code>vars</code> above, we included variables that we did not use in the formula. By design, the simulation and modeling functions ignore extra variables in the <code>variable_list</code> or <code>data</code> inputs. This is just a workflow perk; it allows us to create a comprehensive list of variables we might be interested in, and then we only need adjust the model formula to change the simulations.</p>
<p><br></p>
<p>Sometimes we get simulation results that seem very surprising, and often our first instinct is to suspect the model. When this happens, it can be helpful to remember that the model underlying the simulation functions is highly deterministic to the expected value - which is to say that barring any bugs in the code, there is no stochasticity in the calculations that <code>artemis</code> performs; they are mathematically sound when the pieces are right. There is a random component in simulating the random error, but even that should play out predictably for us. Thus if we’re getting surprising or nonsensical simulations, the trouble probably lies with the assumptions or the data we provided to the model. When we go to look for the source of the unexpected behavior, the input data is almost always the best place to start.</p>
<p><br><br><br> — <br><br></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matt Espe, Myfanwy Johnston.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
