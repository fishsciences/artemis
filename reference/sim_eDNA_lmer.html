<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simulate eDNA data — sim_eDNA_lm • artemis</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate eDNA data — sim_eDNA_lm"><meta property="og:description" content="Simulate eDNA data"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">artemis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/artemis-overview.html">Getting started with the artemis package</a>
    </li>
    <li>
      <a href="../articles/background.html">The motivation behind the artemis package</a>
    </li>
    <li>
      <a href="../articles/count_modeling.html">Modeling count eDNA qPCR Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/model_types.html">Models included in the `artemis` package and when to use them</a>
    </li>
    <li>
      <a href="../articles/modeling.html">Modeling eDNA qPCR Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating eDNA Data with `artemis`</a>
    </li>
    <li>
      <a href="../articles/zero_inflated.html">Modeling Zero-Inflated eDNA qPCR Data with `artemis`</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate eDNA data</h1>

    <div class="hidden name"><code>sim_eDNA_lmer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulate eDNA data</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim_eDNA_lm</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">variable_list</span>,</span>
<span>  <span class="va">betas</span>,</span>
<span>  <span class="va">sigma_ln_eDNA</span>,</span>
<span>  <span class="va">std_curve_alpha</span>,</span>
<span>  <span class="va">std_curve_beta</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  upper_Cq <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  prob_zero <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">variable_list</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">R_user_dir</a></span><span class="op">(</span><span class="st">"artemis"</span>, <span class="st">"cache"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sim_eDNA_lmer</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">variable_list</span>,</span>
<span>  <span class="va">betas</span>,</span>
<span>  <span class="va">sigma_ln_eDNA</span>,</span>
<span>  <span class="va">sigma_rand</span>,</span>
<span>  <span class="va">std_curve_alpha</span>,</span>
<span>  <span class="va">std_curve_beta</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  upper_Cq <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  prob_zero <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">variable_list</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">R_user_dir</a></span><span class="op">(</span><span class="st">"artemis"</span>, <span class="st">"cache"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a model formula, e.g. <code>y ~ x1 + x2</code>. For
<code>sim_eDNA_lmer</code>, random intercepts can also be provided,
e.g. <code> ( 1 | rep ) </code>.</p></dd>


<dt id="arg-variable-list">variable_list<a class="anchor" aria-label="anchor" href="#arg-variable-list"></a></dt>
<dd><p>a named list, with the levels that each
variable can take.  Please note that the variables listed in
the formula, including the response variable, must be present
in the variable_list or in the X design matrix.  Extra
variables, i.e. variables which do not occur in the formula,
are ignored.</p></dd>


<dt id="arg-betas">betas<a class="anchor" aria-label="anchor" href="#arg-betas"></a></dt>
<dd><p>numeric vector, the beta for each variable in the
design matrix</p></dd>


<dt id="arg-sigma-ln-edna">sigma_ln_eDNA<a class="anchor" aria-label="anchor" href="#arg-sigma-ln-edna"></a></dt>
<dd><p>numeric, the measurement error on ln[eDNA].</p></dd>


<dt id="arg-std-curve-alpha">std_curve_alpha<a class="anchor" aria-label="anchor" href="#arg-std-curve-alpha"></a></dt>
<dd><p>the alpha value for the formula for
converting between log(eDNA concentration) and CQ value</p></dd>


<dt id="arg-std-curve-beta">std_curve_beta<a class="anchor" aria-label="anchor" href="#arg-std-curve-beta"></a></dt>
<dd><p>the beta value for the formula for
converting between log(eDNA concentration) and CQ value</p></dd>


<dt id="arg-n-sim">n_sim<a class="anchor" aria-label="anchor" href="#arg-n-sim"></a></dt>
<dd><p>integer, the number of cases to simulate</p></dd>


<dt id="arg-upper-cq">upper_Cq<a class="anchor" aria-label="anchor" href="#arg-upper-cq"></a></dt>
<dd><p>numeric, the upper limit on CQ detection. Any
value of log(concentration) which would result in a value
greater than this limit is instead recorded as the limit.</p></dd>


<dt id="arg-prob-zero">prob_zero<a class="anchor" aria-label="anchor" href="#arg-prob-zero"></a></dt>
<dd><p>numeric, between 0 and 1. The probability of
seeing a non-detection (i.e., a "zero") via the zero-inflated
mechanism. Defaults to 0.08.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>optional, a design matrix. By default, this is created
from the variable_list using <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code>, which
creates a balanced design matrix. However, the user can
provide their own <code>X</code> as well, in which case the
variable_list is ignored. This allows users to provide an
unbalanced design matrix.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical, when TRUE output from
<code>rstan::sampling</code> is written to the console.</p></dd>


<dt id="arg-cache-dir">cache_dir<a class="anchor" aria-label="anchor" href="#arg-cache-dir"></a></dt>
<dd><p>the cache directory where pre-compiled models are
stored. Defaults to the output of
<code>tools::R_user_dir("artemis", "cache")</code></p></dd>


<dt id="arg-sigma-rand">sigma_rand<a class="anchor" aria-label="anchor" href="#arg-sigma-rand"></a></dt>
<dd><p>numeric vector, the stdev for the random
effects. There must be one sigma per random effect specified</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>S4 object of class "eDNA_simulation_{lm/lmer}" with the
    following slots:</p><dl><dt>ln_conc matrix</dt>
<dd><p>the
    simulated log(concentration)</p></dd>

<dt>Cq_star matrix</dt>
<dd><p>the
    simulated CQ values, including the measurement error</p></dd>

<dt>formula</dt>
<dd><p>the formula for the simulation</p></dd>

<dt>variable_levels</dt>
<dd><p>named list, the variable levels used
    for the simulation</p></dd>

<dt>betas</dt>
<dd><p>numeric vector, the betas for
    the simulation</p></dd>

<dt>x</dt>
<dd><p>data.frame, the design matrix</p></dd>

<dt>std_curve_alpha numeric</dt>
<dd><p>the alpha for the std curve
    conversion</p></dd>

<dt>std_curve_beta numeric</dt>
<dd><p>the alpha for the
    std curve conversion</p></dd>

<dt>upper_Cq</dt>
<dd><p>the upper limit for CQ</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>These functions allow for computationally efficient simulation of
Cq values from a hypothetical eDNA sampling experiment via a
series of effect sizes (<code>betas</code>) on a number of predictor or
variable levels (<code>variable_levels</code>). The mechanism for this
model is described in detail in the artemis "Getting Started"
vignette.</p>
<p>The simulation functions call to specialized functions which are
written in Stan and are compiled to provide speed. This also
allows the simulation functions and the modeling functions to
reflect the same process at the code level.</p>
    </div>
    <div id="diagnosing-unrealistic-simulations">
    <h2>Diagnosing "unrealistic" simulations</h2>



<p>Users will find that sometimes the simulationed response (i.e. Cq
values) produced by this function are not similar to expected data
collected from a sampling experiment. This circumstance suggests
that there is a mismatch between the assumptions of the model and
the data generating process in the field. For these circumstances,
we suggest:</p>
<ol><li><p>Check that the <code>betas</code> provided are the
effect sizes on the predictor on the log[eDNA concentration], and
not the Cq values.</p></li>
<li><p>Check that the variable levels provided are representative
of real-world circumstances. For example, a sample volume of 0 ml
is not possible.</p></li>
<li><p>Verify the values for the standard curve alpha and
beta. These are specific to each calibration for the lab, so it is
important that you use the same conversion between Cq values and
log[eDNA concentration] as the comparison data.</p></li>
</ol></div>
    <div id="author">
    <h2>Author</h2>
    <p>Matt Espe</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## Includes extra variables</span></span></span>
<span class="r-in"><span><span class="va">vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="op">-</span><span class="fl">10.6</span>,</span></span>
<span class="r-in"><span>            distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            biomass <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>            alive <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>            tech_rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>            rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, Cq <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Intercept only</span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">=</span> <span class="fu">sim_eDNA_lm</span><span class="op">(</span><span class="va">Cq</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">vars</span>,</span></span>
<span class="r-in"><span>                      betas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="op">-</span><span class="fl">15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      sigma_ln_eDNA <span class="op">=</span> <span class="fl">1e-5</span>,</span></span>
<span class="r-in"><span>                      std_curve_alpha <span class="op">=</span> <span class="fl">21.2</span>, std_curve_beta <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> There are no sampler diagnostics when fixed_param = TRUE.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'ans' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">=</span> <span class="fu">sim_eDNA_lm</span><span class="op">(</span><span class="va">Cq</span> <span class="op">~</span> <span class="va">distance</span> <span class="op">+</span> <span class="va">volume</span>, <span class="va">vars</span>,</span></span>
<span class="r-in"><span>                  betas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="op">-</span><span class="fl">10.6</span>, distance <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span>, volume <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  sigma_ln_eDNA <span class="op">=</span> <span class="fl">1</span>, std_curve_alpha <span class="op">=</span> <span class="fl">21.2</span>, std_curve_beta <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> There are no sampler diagnostics when fixed_param = TRUE.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Matt Espe, Myfanwy Johnston.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer></div>






  </body></html>

